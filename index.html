    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Goblooter</title>
        <style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #000000;
			background-image: url('assets/images/frame.png');
			background-size: cover; /* This makes the background image cover the entire background */
			background-repeat: no-repeat; /* This prevents the background image from repeating */
			background-position: center; /* This centers the background image */
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			flex-direction: column;
		}
		canvas {
                display: block;
                margin: auto;
                border: 1px solid #ccc;
                background-color: #000000;
		}
		#gameCanvas {
				display: none; /* Initially hide the game canvas */

        }
		#titleScreen {
				display: block; /* Initially hide the game canvas */
        }
		#startButton {
				display: block; /* Initially hide the game canvas */
				width: 300px;
				height: 150px;
				font-size: 24px;
				cursor: pointer;
        }
        </style>
    </head>
    <body>
        <canvas id="gameCanvas" width="1670" height="880"></canvas>
		<script src="bagFunctions.js"></script>
		<script src="items.js"></script>
		    <div id="titleScreen">
				<h1>Goblooter</h1>
				<button id="startButton">Start</button>
			</div>
		<script>
const titleScreen = document.getElementById("titleScreen");
const startButton = document.getElementById("startButton");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Button coordinates
const buttonX = gameCanvas.width / 2 - 75;
const buttonY = gameCanvas.height / 2 + 60;
const buttonWidth = 150;
const buttonHeight = 50;


const cellSize = 50;
const size = 50;
const bagPadding = 10;

// Bag dimensions and position
const bagXpos = 50;
const bagYpos = 240;
const bagWidth = 450;
const bagHeight = 800;
let mainWidth = 800;
let mainHeight = 600;

// Array to store items
const items = [];
const baggedItems = [];
let draggedItem;
// Array to store cells in the bag grid
const numbers = [];
const columns = 8;
const rows = 10;
let bagCells = new cellsContainer;
let initialCell;
let checkedCells;
let highlightedCells;
let gameStarted = false; // Flag to track if the game has started
let timer; // Variable to hold the countdown timer
let timeLeft = 125; // Time left in seconds (2 minutes)
let intervalId; // Variable to hold the interval ID for the item generation
let countdownIntervalId; // Variable to hold the interval ID for the countdown
let flashColor = "red"; // Variable to alternate flashing colors
let flashIntervalId; // Variable to hold the interval ID for flashing text


// Add event listener to start button
startButton.addEventListener("click", startGame);




		// Function to start the game
	function startGame() {
		// Render bag grid
		initCells();
		// Start the game loop
		setInterval(gameLoop, 60);
		gameCanvas.style.display = "block";
		startButton.style.display = "none"; // Hide the start button

		// Reset the game state
		resetGameState();

		// Start the countdown timer
		countdownIntervalId = setInterval(updateTimer, 1000);

		// Start generating items every 5 seconds
		intervalId = setInterval(generateItems, 5000);
		gameStarted = true;

		// Initial item generation
		generateItems();
	}
function updateTimer() {
    timeLeft -= 1; // Decrease time left by 1 second
    if (timeLeft <= 0) {
        stopGame();
    }
}

// Function to stop the game
function stopGame() {
		gameStarted = false;
    clearInterval(intervalId); // Clear the item generation interval
    clearInterval(countdownIntervalId); // Clear the countdown timer interval
    clearInterval(flashIntervalId); // Clear the flash interval
		    // Dim the canvas and display "Game Over" and total value
		ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
		ctx.fillRect(0, 0, canvas.width, canvas.height);

		ctx.fillStyle = "rgba(255, 255, 255, 1)";
		ctx.font = "48px Arial";
		ctx.textAlign = "center";
		ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 20);


    // Display the total value and make it flash
    flashTotalValue();


}
// Function to flash the total value text
function flashTotalValue() {
   flashIntervalId = setInterval(() => {
        flashColor = (flashColor === "red") ? "blue" : "red";
        ctx.fillStyle = flashColor;
        ctx.font = "36px Arial";
        ctx.textAlign = "center";
        ctx.fillText(`You earned: $${calculateTotalValue()}`, canvas.width / 2, canvas.height / 2 + 40);
    }, 50); // Flash every 500 milliseconds
}

// Function to reset the game state
function resetGameState() {
	timeLeft = 125; // Reset time left to 2 minutes
    items.length = 0; // Clear items array
    baggedItems.length = 0; // Clear bagged items array
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Clear the flash interval if it's running

}


// Function to handle mouse down event
canvas.addEventListener("mousedown", function(event) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = event.clientX - rect.left;
    const mouseY = event.clientY - rect.top;
   console.log(mouseX, mouseY);

    // Check if mouse click is inside any item
    for (let i = 0; i < items.length; i++) {
        const item = items[i];
        if ((mouseX >= item.x && mouseX <= item.x + item.size &&
            mouseY >= item.y && mouseY <= item.y + item.size)) {
			if (item.isInBag) {
                clearOccupiedCells(item);
            }
            // Set dragging flag and save offset
            item.isDragging = true;
            item.dragOffsetX = mouseX - item.x;
            item.dragOffsetY = mouseY - item.y;
            // Set the dragged item
            draggedItem = item;

			
            break;
        }
    }


});

document.addEventListener("keydown", event => {
    if (event.code === "Space" && draggedItem) {
        reverseShape(draggedItem);
    }
});



// Function to handle mouse up event
canvas.addEventListener("mouseup", function(event) {
    // Check if an item is being dragged
    if (draggedItem) {
       if (isOverBagGrid(draggedItem)) {   
		dropItemInBag(draggedItem);	   
        // Reset dragging flag
		console.log("itemPos: ", draggedItem.x, draggedItem.y);
		draggedItem.isDragging = false;
        draggedItem = null;
		
 } else if (!isOverBagGrid(draggedItem)) {
        draggedItem.isDragging = false;
        draggedItem = null;
}
}
});

// Function to handle mouse move event
canvas.addEventListener("mousemove", function(event) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = event.clientX - rect.left;
    const mouseY = event.clientY - rect.top;

    // Update position of dragged item
    if (draggedItem) {
        draggedItem.x = mouseX - draggedItem.dragOffsetX;
        draggedItem.y = mouseY - draggedItem.dragOffsetY;
        draggedItem.sizeX = draggedItem.size * draggedItem.gridSizeX;
        draggedItem.sizeY = draggedItem.size * draggedItem.gridSizeY;

 

    }
});


// Function to render items and bag grid
function render() {

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Render main window border
    ctx.strokeStyle = "white";
    ctx.strokeRect(560, 240, mainWidth, mainHeight);
    // Render bag border
    ctx.strokeRect(bagXpos, bagYpos, columns * cellSize + 2 * bagPadding, rows * cellSize + 2 * bagPadding);
    //render cells
    bagCells.cells.forEach(cell => {

        cell.drawCell();


    });
		drawBaggedItems(baggedItems);
	if (draggedItem && isOverBagGrid(draggedItem)) {
		highlightCells(draggedItem);
}
    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.fillText("Items in bag:  " + baggedItems.length, bagXpos, bagYpos - 30);
    ctx.fillText("Total value:  " + calculateTotalValue(), bagXpos, bagYpos - 10);
// Convert timer to seconds and display
    ctx.fillText(`Time Left: ${timeLeft} seconds`, bagXpos, bagYpos + (cellSize * (rows + 1)));


        // Render items
    items.forEach(item => {
        ctx.fillStyle = item.color;
       // ctx.fillRect(item.x, item.y, item.size, item.size);
        if (!item.isDragging && !item.IsInBag) {
            ctx.fillStyle = item.color;
            ctx.fillRect(item.x, item.y, item.size, item.size); // Original size
        } else if (item.isDragging || item.IsInBag) {
            // Adjusted size for dragging
            ctx.fillStyle = item.color;
            ctx.fillRect(item.x, item.y, (item.size * 2) * item.gridSizeX, (item.size * 2) * item.gridSizeY);
            // Render tooltip
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            const text = item.name;
            const textWidth = ctx.measureText(text).width;
            ctx.fillRect(item.x + item.size + 10, item.y - 30, textWidth, 50);
            ctx.fillStyle = "black";
            ctx.font = "12px Arial";
            ctx.fillText(item.name, item.x + item.size + 15, item.y - 15);
            ctx.fillText("Value: " + item.value, item.x + item.size + 15, item.y);
            ctx.fillText("Type: " + item.type, item.x + item.size + 15, item.y + 15);
        }


    });

    
}

// Function to draw a button on the canvas
function drawButton(text) {
    ctx.fillStyle = "white";
    ctx.fillRect(buttonX, buttonY, buttonWidth, buttonHeight);
    ctx.fillStyle = "black";
    ctx.font = "24px Arial";
    ctx.textAlign = "center";
    ctx.fillText(text, buttonX + buttonWidth / 2, buttonY + buttonHeight / 2 + 8);
}



// Main game loop
function gameLoop() {
        if (gameStarted) {
        render();
    }
}





        </script>
    </body>
    </html>


